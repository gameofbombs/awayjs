"use strict";
var Sampler2D_1 = require("awayjs-core/lib/image/Sampler2D");
var URLLoader_1 = require("awayjs-core/lib/net/URLLoader");
var URLLoaderDataFormat_1 = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var URLLoaderEvent_1 = require("awayjs-core/lib/events/URLLoaderEvent");
var ParserUtils_1 = require("awayjs-core/lib/parsers/ParserUtils");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var View_1 = require("awayjs-display/lib/View");
var PointLight_1 = require("awayjs-display/lib/display/PointLight");
var ElementsType_1 = require("awayjs-display/lib/graphics/ElementsType");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var PrimitiveTorusPrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var TorusObject3DDemo = (function () {
    function TorusObject3DDemo() {
        var _this = this;
        this.t = 0;
        this.tPos = 0;
        this.radius = 1000;
        this.follow = true;
        Debug_1.Debug.THROW_ERRORS = false;
        Debug_1.Debug.LOG_PI_ERRORS = false;
        this.sprites = new Array();
        this.light = new PointLight_1.PointLight();
        this.view = new View_1.View(new DefaultRenderer_1.DefaultRenderer());
        this.pointLight = new PointLight_1.PointLight();
        this.lightPicker = new StaticLightPicker_1.StaticLightPicker([this.pointLight]);
        this.view.scene.addChild(this.pointLight);
        var perspectiveLens = this.view.camera.projection;
        perspectiveLens.fieldOfView = 75;
        this.view.camera.z = 0;
        this.view.backgroundColor = 0x000000;
        this.view.backgroundAlpha = 1;
        this.view.scene.addChild(this.light);
        this.raf = new RequestAnimationFrame_1.RequestAnimationFrame(this.tick, this);
        this.raf.start();
        this.onResize();
        document.onmousedown = function (event) { return _this.followObject(event); };
        window.onresize = function (event) { return _this.onResize(event); };
        this.loadResources();
    }
    TorusObject3DDemo.prototype.loadResources = function () {
        var _this = this;
        var urlRequest = new URLRequest_1.URLRequest("assets/custom_uv_horizontal.png");
        var urlLoader = new URLLoader_1.URLLoader();
        urlLoader.dataFormat = URLLoaderDataFormat_1.URLLoaderDataFormat.BLOB;
        urlLoader.addEventListener(URLLoaderEvent_1.URLLoaderEvent.LOAD_COMPLETE, function (event) { return _this.imageCompleteHandler(event); });
        urlLoader.load(urlRequest);
    };
    TorusObject3DDemo.prototype.imageCompleteHandler = function (event) {
        var _this = this;
        var urlLoader = event.target;
        this._image = ParserUtils_1.ParserUtils.blobToImage(urlLoader.data);
        this._image.onload = function (event) { return _this.onImageLoadComplete(event); };
    };
    TorusObject3DDemo.prototype.onImageLoadComplete = function (event) {
        var matTx = new MethodMaterial_1.MethodMaterial(ParserUtils_1.ParserUtils.imageToBitmapImage2D(this._image));
        matTx.style.sampler = new Sampler2D_1.Sampler2D(true, true, true);
        matTx.lightPicker = this.lightPicker;
        var torus = new PrimitiveTorusPrefab_1.PrimitiveTorusPrefab(matTx, ElementsType_1.ElementsType.TRIANGLE, 150, 50, 32, 32, false);
        var l = 10;
        //var radius:number = 1000;
        for (var c = 0; c < l; c++) {
            var t = Math.PI * 2 * c / l;
            var sprite = torus.getNewObject();
            sprite.x = Math.cos(t) * this.radius;
            sprite.y = 0;
            sprite.z = Math.sin(t) * this.radius;
            this.view.scene.addChild(sprite);
            this.sprites.push(sprite);
        }
    };
    TorusObject3DDemo.prototype.tick = function (dt) {
        this.tPos += .02;
        for (var c = 0; c < this.sprites.length; c++) {
            var objPos = Math.PI * 2 * c / this.sprites.length;
            this.t += .005;
            var s = 1.2 + Math.sin(this.t + objPos);
            this.sprites[c].rotationY += 2 * (c / this.sprites.length);
            this.sprites[c].rotationX += 2 * (c / this.sprites.length);
            this.sprites[c].rotationZ += 2 * (c / this.sprites.length);
            this.sprites[c].scaleX = this.sprites[c].scaleY = this.sprites[c].scaleZ = s;
            this.sprites[c].x = Math.cos(objPos + this.tPos) * this.radius;
            this.sprites[c].y = Math.sin(this.t) * 500;
            this.sprites[c].z = Math.sin(objPos + this.tPos) * this.radius;
            if (this.follow && c == 0)
                this.view.camera.lookAt(this.sprites[c].transform.position);
        }
        //this.view.camera.y = Math.sin( this.tPos ) * 1500;
        this.view.camera.y = Math.sin(this.tPos) * 1500;
        this.view.render();
    };
    TorusObject3DDemo.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    TorusObject3DDemo.prototype.followObject = function (e) {
        this.follow = !this.follow;
    };
    return TorusObject3DDemo;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9iamVjdDNkL1RvcnVzT2JqZWN0M0REZW1vLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQkFBNEIsaUNBQWlDLENBQUMsQ0FBQTtBQUM5RCwwQkFBNEIsK0JBQStCLENBQUMsQ0FBQTtBQUM1RCxvQ0FBb0MseUNBQXlDLENBQUMsQ0FBQTtBQUM5RSwyQkFBNkIsZ0NBQWdDLENBQUMsQ0FBQTtBQUM5RCwrQkFBZ0MsdUNBQXVDLENBQUMsQ0FBQTtBQUN4RSw0QkFBOEIscUNBQXFDLENBQUMsQ0FBQTtBQUVwRSxzQ0FBcUMsNkNBQTZDLENBQUMsQ0FBQTtBQUNuRixzQkFBeUIsNkJBQTZCLENBQUMsQ0FBQTtBQUV2RCxxQkFBeUIseUJBQXlCLENBQUMsQ0FBQTtBQUVuRCwyQkFBNkIsdUNBQXVDLENBQUMsQ0FBQTtBQUNyRSw2QkFBK0IsMENBQTBDLENBQUMsQ0FBQTtBQUMxRSxrQ0FBa0MsNkRBQTZELENBQUMsQ0FBQTtBQUNoRyxxQ0FBcUMsaURBQWlELENBQUMsQ0FBQTtBQUV2RixnQ0FBaUMsdUNBQXVDLENBQUMsQ0FBQTtBQUV6RSwrQkFBZ0MsMkNBQTJDLENBQUMsQ0FBQTtBQUU1RTtJQWtCQztRQWxCRCxpQkF5SUM7UUFqSVEsTUFBQyxHQUFVLENBQUMsQ0FBQztRQUNiLFNBQUksR0FBVSxDQUFDLENBQUM7UUFDaEIsV0FBTSxHQUFVLElBQUksQ0FBQztRQUNyQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBUzdCLGFBQUssQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQzNCLGFBQUssQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBRTVCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQVUsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksdUJBQVUsRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxXQUFJLENBQUMsSUFBSSxpQ0FBZSxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJ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QUFDLE1BQU0sQ0FBQztZQUVsRCxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQztZQUNmLElBQUksQ0FBQyxHQUFVLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7WUFFL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQzdFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQzdELElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFDLEdBQUcsQ0FBQztZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUU3RCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsb0RBQW9EO1FBRXBELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFaEQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRU0sb0NBQVEsR0FBZixVQUFnQixLQUFvQjtRQUFwQixxQkFBb0IsR0FBcEIsWUFBb0I7UUFFbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVoQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDdkMsQ0FBQztJQUVNLHdDQUFZLEdBQW5CLFVBQW9CLENBQUM7UUFFcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDNUIsQ0FBQztJQUNGLHdCQUFDO0FBQUQsQ0F6SUEsQUF5SUMsSUFBQSIsImZpbGUiOiJvYmplY3QzZC9Ub3J1c09iamVjdDNERGVtby5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7U2FtcGxlcjJEfVx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL1NhbXBsZXIyRFwiO1xuaW1wb3J0IHtVUkxMb2FkZXJ9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlclwiO1xuaW1wb3J0IHtVUkxMb2FkZXJEYXRhRm9ybWF0fVx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIjtcbmltcG9ydCB7VVJMUmVxdWVzdH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IHtVUkxMb2FkZXJFdmVudH1cdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1VSTExvYWRlckV2ZW50XCI7XG5pbXBvcnQge1BhcnNlclV0aWxzfVx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyVXRpbHNcIjtcbmltcG9ydCB7UGVyc3BlY3RpdmVQcm9qZWN0aW9ufVx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1BlcnNwZWN0aXZlUHJvamVjdGlvblwiO1xuaW1wb3J0IHtSZXF1ZXN0QW5pbWF0aW9uRnJhbWV9XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCI7XG5pbXBvcnQge0RlYnVnfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvdXRpbHMvRGVidWdcIjtcblxuaW1wb3J0IHtWaWV3fVx0XHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9WaWV3XCI7XG5pbXBvcnQge1Nwcml0ZX1cdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvU3ByaXRlXCI7XG5pbXBvcnQge1BvaW50TGlnaHR9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9Qb2ludExpZ2h0XCI7XG5pbXBvcnQge0VsZW1lbnRzVHlwZX1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9ncmFwaGljcy9FbGVtZW50c1R5cGVcIjtcbmltcG9ydCB7U3RhdGljTGlnaHRQaWNrZXJ9XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvbGlnaHRwaWNrZXJzL1N0YXRpY0xpZ2h0UGlja2VyXCI7XG5pbXBvcnQge1ByaW1pdGl2ZVRvcnVzUHJlZmFifVx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVUb3J1c1ByZWZhYlwiO1xuXG5pbXBvcnQge0RlZmF1bHRSZW5kZXJlcn1cdFx0XHRcdGZyb20gXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCI7XG5cbmltcG9ydCB7TWV0aG9kTWF0ZXJpYWx9XHRcdFx0XHRmcm9tIFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvTWV0aG9kTWF0ZXJpYWxcIjtcblxuY2xhc3MgVG9ydXNPYmplY3QzRERlbW9cbntcblx0cHJpdmF0ZSB2aWV3OlZpZXc7XG5cblx0cHJpdmF0ZSBsaWdodDpQb2ludExpZ2h0O1xuXHRwcml2YXRlIHJhZjpSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XG5cdHByaXZhdGUgc3ByaXRlczpBcnJheTxTcHJpdGU+O1xuXG5cdHByaXZhdGUgdDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIHRQb3M6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSByYWRpdXM6bnVtYmVyID0gMTAwMDtcblx0cHJpdmF0ZSBmb2xsb3c6Ym9vbGVhbiA9IHRydWU7XG5cblx0cHJpdmF0ZSBwb2ludExpZ2h0OlBvaW50TGlnaHQ7XG5cdHByaXZhdGUgbGlnaHRQaWNrZXI6U3RhdGljTGlnaHRQaWNrZXI7XG5cblx0cHJpdmF0ZSBfaW1hZ2U6SFRNTEltYWdlRWxlbWVudDtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHREZWJ1Zy5USFJPV19FUlJPUlMgPSBmYWxzZTtcblx0XHREZWJ1Zy5MT0dfUElfRVJST1JTID0gZmFsc2U7XG5cblx0XHR0aGlzLnNwcml0ZXMgPSBuZXcgQXJyYXk8U3ByaXRlPigpO1xuXHRcdHRoaXMubGlnaHQgPSBuZXcgUG9pbnRMaWdodCgpO1xuXHRcdHRoaXMudmlldyA9IG5ldyBWaWV3KG5ldyBEZWZhdWx0UmVuZGVyZXIoKSk7XG5cdFx0dGhpcy5wb2ludExpZ2h0ID0gbmV3IFBvaW50TGlnaHQoKTtcblx0XHR0aGlzLmxpZ2h0UGlja2VyID0gbmV3IFN0YXRpY0xpZ2h0UGlja2VyKFt0aGlzLnBvaW50TGlnaHRdKTtcblxuXHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLnBvaW50TGlnaHQpO1xuXG5cdFx0dmFyIHBlcnNwZWN0aXZlTGVuczpQZXJzcGVjdGl2ZVByb2plY3Rpb24gPSA8UGVyc3BlY3RpdmVQcm9qZWN0aW9uPiB0aGlzLnZpZXcuY2FtZXJhLnByb2plY3Rpb247XG5cdFx0cGVyc3BlY3RpdmVMZW5zLmZpZWxkT2ZWaWV3ID0gNzU7XG5cblx0XHR0aGlzLnZpZXcuY2FtZXJhLnogPSAwO1xuXHRcdHRoaXMudmlldy5iYWNrZ3JvdW5kQ29sb3IgPSAweDAwMDAwMDtcblx0XHR0aGlzLnZpZXcuYmFja2dyb3VuZEFscGhhID0gMTtcblxuXHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLmxpZ2h0KTtcblxuXHRcdHRoaXMucmFmID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnRpY2ssIHRoaXMpO1xuXHRcdHRoaXMucmFmLnN0YXJ0KCk7XG5cdFx0dGhpcy5vblJlc2l6ZSgpO1xuXG5cdFx0ZG9jdW1lbnQub25tb3VzZWRvd24gPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5mb2xsb3dPYmplY3QoZXZlbnQpO1xuXG5cdFx0d2luZG93Lm9ucmVzaXplID0gKGV2ZW50OlVJRXZlbnQpID0+IHRoaXMub25SZXNpemUoZXZlbnQpO1xuXG5cdFx0dGhpcy5sb2FkUmVzb3VyY2VzKCk7XG5cdH1cblxuXHRwcml2YXRlIGxvYWRSZXNvdXJjZXMoKVxuXHR7XG5cdFx0dmFyIHVybFJlcXVlc3Q6VVJMUmVxdWVzdCA9IG5ldyBVUkxSZXF1ZXN0KFwiYXNzZXRzL2N1c3RvbV91dl9ob3Jpem9udGFsLnBuZ1wiKTtcblx0XHR2YXIgdXJsTG9hZGVyOlVSTExvYWRlciA9IG5ldyBVUkxMb2FkZXIoKTtcblx0XHR1cmxMb2FkZXIuZGF0YUZvcm1hdCA9IFVSTExvYWRlckRhdGFGb3JtYXQuQkxPQjtcblx0XHR1cmxMb2FkZXIuYWRkRXZlbnRMaXN0ZW5lcihVUkxMb2FkZXJFdmVudC5MT0FEX0NPTVBMRVRFLCAoZXZlbnQ6VVJMTG9hZGVyRXZlbnQpID0+IHRoaXMuaW1hZ2VDb21wbGV0ZUhhbmRsZXIoZXZlbnQpKTtcblx0XHR1cmxMb2FkZXIubG9hZCh1cmxSZXF1ZXN0KTtcblx0fVxuXG5cdHByaXZhdGUgaW1hZ2VDb21wbGV0ZUhhbmRsZXIoZXZlbnQ6VVJMTG9hZGVyRXZlbnQpXG5cdHtcblx0XHR2YXIgdXJsTG9hZGVyOlVSTExvYWRlciA9IGV2ZW50LnRhcmdldDtcblxuXHRcdHRoaXMuX2ltYWdlID0gUGFyc2VyVXRpbHMuYmxvYlRvSW1hZ2UodXJsTG9hZGVyLmRhdGEpO1xuXHRcdHRoaXMuX2ltYWdlLm9ubG9hZCA9IChldmVudDpFdmVudCkgPT4gdGhpcy5vbkltYWdlTG9hZENvbXBsZXRlKGV2ZW50KTtcblxuXHR9XG5cblx0cHJpdmF0ZSBvbkltYWdlTG9hZENvbXBsZXRlKGV2ZW50OkV2ZW50KVxuXHR7XG5cdFx0dmFyIG1hdFR4Ok1ldGhvZE1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsKFBhcnNlclV0aWxzLmltYWdlVG9CaXRtYXBJbWFnZTJEKHRoaXMuX2ltYWdlKSk7XG5cdFx0bWF0VHguc3R5bGUuc2FtcGxlciA9IG5ldyBTYW1wbGVyMkQodHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG5cdFx0bWF0VHgubGlnaHRQaWNrZXIgPSAgdGhpcy5saWdodFBpY2tlcjtcblxuXHRcdHZhciB0b3J1czpQcmltaXRpdmVUb3J1c1ByZWZhYiA9IG5ldyBQcmltaXRpdmVUb3J1c1ByZWZhYihtYXRUeCwgRWxlbWVudHNUeXBlLlRSSUFOR0xFLCAxNTAsIDUwLCAzMiwgMzIsIGZhbHNlKTtcblxuXHRcdHZhciBsOm51bWJlciA9IDEwO1xuXHRcdC8vdmFyIHJhZGl1czpudW1iZXIgPSAxMDAwO1xuXG5cdFx0Zm9yICh2YXIgYyA6IG51bWJlciA9IDA7IGMgPCBsIDsgYysrKSB7XG5cblx0XHRcdHZhciB0IDogbnVtYmVyPU1hdGguUEkgKiAyICogYyAvIGw7XG5cblx0XHRcdHZhciBzcHJpdGU6U3ByaXRlID0gPFNwcml0ZT4gdG9ydXMuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRzcHJpdGUueCA9IE1hdGguY29zKHQpKnRoaXMucmFkaXVzO1xuXHRcdFx0c3ByaXRlLnkgPSAwO1xuXHRcdFx0c3ByaXRlLnogPSBNYXRoLnNpbih0KSp0aGlzLnJhZGl1cztcblxuXHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHNwcml0ZSk7XG5cdFx0XHR0aGlzLnNwcml0ZXMucHVzaChzcHJpdGUpO1xuXG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSB0aWNrKGR0Om51bWJlcilcblx0e1xuXHRcdHRoaXMudFBvcyArPSAuMDI7XG5cblx0XHRmb3IgKHZhciBjOm51bWJlciA9IDAgOyBjIDwgdGhpcy5zcHJpdGVzLmxlbmd0aCA7IGMgKyspIHtcblx0XHRcdHZhciBvYmpQb3M6bnVtYmVyPU1hdGguUEkqMipjL3RoaXMuc3ByaXRlcy5sZW5ndGg7XG5cblx0XHRcdHRoaXMudCArPSAuMDA1O1xuXHRcdFx0dmFyIHM6bnVtYmVyID0gMS4yICsgTWF0aC5zaW4odGhpcy50ICsgb2JqUG9zKTtcblxuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnJvdGF0aW9uWSArPSAyKihjL3RoaXMuc3ByaXRlcy5sZW5ndGgpO1xuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnJvdGF0aW9uWCArPSAyKihjL3RoaXMuc3ByaXRlcy5sZW5ndGgpO1xuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnJvdGF0aW9uWiArPSAyKihjL3RoaXMuc3ByaXRlcy5sZW5ndGgpO1xuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnNjYWxlWCA9IHRoaXMuc3ByaXRlc1tjXS5zY2FsZVkgPSB0aGlzLnNwcml0ZXNbY10uc2NhbGVaID0gcztcblx0XHRcdHRoaXMuc3ByaXRlc1tjXS54ID0gTWF0aC5jb3Mob2JqUG9zICsgdGhpcy50UG9zKSp0aGlzLnJhZGl1cztcblx0XHRcdHRoaXMuc3ByaXRlc1tjXS55ID0gTWF0aC5zaW4odGhpcy50KSo1MDA7XG5cdFx0XHR0aGlzLnNwcml0ZXNbY10ueiA9IE1hdGguc2luKG9ialBvcyArIHRoaXMudFBvcykqdGhpcy5yYWRpdXM7XG5cblx0XHRcdGlmICh0aGlzLmZvbGxvdyAmJiBjID09IDApXG5cdFx0XHRcdHRoaXMudmlldy5jYW1lcmEubG9va0F0KHRoaXMuc3ByaXRlc1tjXS50cmFuc2Zvcm0ucG9zaXRpb24pO1xuXHRcdH1cblxuXHRcdC8vdGhpcy52aWV3LmNhbWVyYS55ID0gTWF0aC5zaW4oIHRoaXMudFBvcyApICogMTUwMDtcblxuXHRcdHRoaXMudmlldy5jYW1lcmEueSA9IE1hdGguc2luKHRoaXMudFBvcykgKiAxNTAwO1xuXG5cdFx0dGhpcy52aWV3LnJlbmRlcigpO1xuXHR9XG5cblx0cHVibGljIG9uUmVzaXplKGV2ZW50OlVJRXZlbnQgPSBudWxsKVxuXHR7XG5cdFx0dGhpcy52aWV3LnkgPSAwO1xuXHRcdHRoaXMudmlldy54ID0gMDtcblxuXHRcdHRoaXMudmlldy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHRcdHRoaXMudmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgZm9sbG93T2JqZWN0KGUpXG5cdHtcblx0XHR0aGlzLmZvbGxvdyA9ICF0aGlzLmZvbGxvdztcblx0fVxufSJdLCJzb3VyY2VSb290IjoiLi90ZXN0cyJ9
