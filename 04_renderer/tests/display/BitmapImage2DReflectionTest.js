"use strict";
var BitmapImage2D_1 = require("awayjs-core/lib/image/BitmapImage2D");
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View_1 = require("awayjs-display/lib/View");
var PrimitivePlanePrefab_1 = require("awayjs-display/lib/prefabs/PrimitivePlanePrefab");
var ElementsType_1 = require("awayjs-display/lib/graphics/ElementsType");
var BasicMaterial_1 = require("awayjs-display/lib/materials/BasicMaterial");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var BitmapImage2DReflectionTest = (function () {
    function BitmapImage2DReflectionTest() {
        var _this = this;
        this.view = new View_1.View(new DefaultRenderer_1.DefaultRenderer());
        this.raf = new RequestAnimationFrame_1.RequestAnimationFrame(this.render, this);
        var session = AssetLibrary_1.AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent_1.LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.URLRequest('assets/dots.png'));
        window.onresize = function (event) { return _this.onResize(event); };
    }
    BitmapImage2DReflectionTest.prototype.onLoadComplete = function (event) {
        var loader = event.target;
        var l = loader.baseDependency.assets.length;
        for (var c = 0; c < l; c++) {
            var asset = loader.baseDependency.assets[c];
            switch (asset.assetType) {
                case BitmapImage2D_1.BitmapImage2D.assetType:
                    var prefab = new PrimitivePlanePrefab_1.PrimitivePlanePrefab(null, ElementsType_1.ElementsType.TRIANGLE, 500, 500, 1, 1, false);
                    var bitmap = new BitmapImage2D_1.BitmapImage2D(1024, 1024, true, 0x00000000);
                    var imageCanvas = document.createElement("canvas");
                    imageCanvas.width = 1024;
                    imageCanvas.height = 1024;
                    var context = imageCanvas.getContext("2d");
                    var imageData = context.getImageData(0, 0, 1024, 1024);
                    context.translate(0, 1024);
                    context.scale(1, -1);
                    context.drawImage(asset.getCanvas(), 0, 0, 1024, 1024);
                    var gradient = context.createLinearGradient(0, 0, 0, 1024);
                    gradient.addColorStop(0.8, "rgba(255, 255, 255, 1.0)");
                    gradient.addColorStop(1, "rgba(255, 255, 255, 0.5)");
                    context.fillStyle = gradient;
                    context.rect(0, 0, 1024, 1024);
                    context.globalCompositeOperation = "destination-out";
                    context.fill();
                    bitmap.draw(imageCanvas);
                    var bitmapClone = new BitmapImage2D_1.BitmapImage2D(1024, 1024, true, 0x00000000);
                    bitmapClone.copyPixels(bitmap, bitmapClone.rect, bitmapClone.rect);
                    document.body.appendChild(bitmap.getCanvas());
                    var material = new BasicMaterial_1.BasicMaterial(bitmapClone);
                    material.bothSides = true;
                    material.alphaBlending = true;
                    var material2 = new BasicMaterial_1.BasicMaterial(asset);
                    material2.bothSides = true;
                    material2.alphaBlending = true;
                    this.reflectionSprite = prefab.getNewObject();
                    this.reflectionSprite.material = material;
                    this.view.scene.addChild(this.reflectionSprite);
                    this.fullmesh = prefab.getNewObject();
                    this.fullmesh.material = material2;
                    this.fullmesh.rotationY = 90;
                    this.view.scene.addChild(this.fullmesh);
                    break;
            }
        }
        this.raf.start();
        this.onResize();
    };
    BitmapImage2DReflectionTest.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.x = window.innerWidth / 2;
        this.view.width = window.innerWidth / 2;
        this.view.height = window.innerHeight;
    };
    BitmapImage2DReflectionTest.prototype.render = function () {
        this.fullmesh.rotationY += .5;
        this.reflectionSprite.rotationY += .5;
        this.view.render();
    };
    return BitmapImage2DReflectionTest;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpc3BsYXkvQml0bWFwSW1hZ2UyRFJlZmxlY3Rpb25UZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw4QkFBK0IscUNBQXFDLENBQUMsQ0FBQTtBQUNyRSw2QkFBK0Isc0NBQXNDLENBQUMsQ0FBQTtBQUd0RSwyQkFBNkIsZ0NBQWdDLENBQUMsQ0FBQTtBQUM5RCw0QkFBOEIsb0NBQW9DLENBQUMsQ0FBQTtBQUNuRSxzQ0FBcUMsNkNBQTZDLENBQUMsQ0FBQTtBQUVuRixxQkFBeUIseUJBQXlCLENBQUMsQ0FBQTtBQUVuRCxxQ0FBcUMsaURBQWlELENBQUMsQ0FBQTtBQUN2Riw2QkFBK0IsMENBQTBDLENBQUMsQ0FBQTtBQUMxRSw4QkFBK0IsNENBQTRDLENBQUMsQ0FBQTtBQUc1RSxnQ0FBaUMsdUNBQXVDLENBQUMsQ0FBQTtBQUV6RTtJQU9DO1FBUEQsaUJBbUdDO1FBMUZDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxXQUFJLENBQUMsSUFBSSxpQ0FBZSxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksNkNBQXFCLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUV4RCxJQUFJLE9BQU8sR0FBVSwyQkFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzlDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyx5QkFBVyxDQUFDLGFBQWEsRUFBRSxVQUFDLEtBQWlCLElBQUssT0FBQSxLQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUExQixDQUEwQixDQUFDLENBQUM7UUFDdkcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLHVCQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1FBRWhELE1BQU0sQ0FBQyxRQUFRLEdBQUcsVUFBQyxLQUFhLElBQUssT0FBQSxLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFwQixDQUFvQixDQUFDO0lBQzNELENBQUM7SUFFTyxv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LENBQUMsV0FBVyxDQUFDO0lBQ3ZDLENBQUM7SUFFTyw0Q0FBTSxHQUFkO1FBRUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLElBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLElBQUcsRUFBRSxDQUFDO1FBRXJDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUNGLGtDQUFDO0FBQUQsQ0FuR0EsQUFtR0MsSUFBQSIsImZpbGUiOiJkaXNwbGF5L0JpdG1hcEltYWdlMkRSZWZsZWN0aW9uVGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Qml0bWFwSW1hZ2UyRH1cdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvaW1hZ2UvQml0bWFwSW1hZ2UyRFwiO1xuaW1wb3J0IHtBc3NldExpYnJhcnl9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldExpYnJhcnlcIjtcbmltcG9ydCB7TG9hZGVyfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Mb2FkZXJcIjtcbmltcG9ydCB7SUFzc2V0fVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIjtcbmltcG9ydCB7VVJMUmVxdWVzdH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IHtMb2FkZXJFdmVudH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIjtcbmltcG9ydCB7UmVxdWVzdEFuaW1hdGlvbkZyYW1lfVx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL1JlcXVlc3RBbmltYXRpb25GcmFtZVwiO1xuXG5pbXBvcnQge1ZpZXd9XHRcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL1ZpZXdcIjtcbmltcG9ydCB7U3ByaXRlfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9TcHJpdGVcIjtcbmltcG9ydCB7UHJpbWl0aXZlUGxhbmVQcmVmYWJ9XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZVBsYW5lUHJlZmFiXCI7XG5pbXBvcnQge0VsZW1lbnRzVHlwZX1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9ncmFwaGljcy9FbGVtZW50c1R5cGVcIjtcbmltcG9ydCB7QmFzaWNNYXRlcmlhbH1cdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL0Jhc2ljTWF0ZXJpYWxcIjtcbmltcG9ydCB7U2luZ2xlMkRUZXh0dXJlfVx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi90ZXh0dXJlcy9TaW5nbGUyRFRleHR1cmVcIjtcblxuaW1wb3J0IHtEZWZhdWx0UmVuZGVyZXJ9XHRcdFx0XHRmcm9tIFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiO1xuXG5jbGFzcyBCaXRtYXBJbWFnZTJEUmVmbGVjdGlvblRlc3Rcbntcblx0cHJpdmF0ZSB2aWV3OlZpZXc7XG5cdHByaXZhdGUgcmFmOlJlcXVlc3RBbmltYXRpb25GcmFtZTtcblx0cHJpdmF0ZSByZWZsZWN0aW9uU3ByaXRlOlNwcml0ZTtcblx0cHJpdmF0ZSBmdWxsbWVzaDpTcHJpdGU7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0dGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcigpKTtcblx0XHR0aGlzLnJhZiA9IG5ldyBSZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXIsIHRoaXMpO1xuXG5cdFx0dmFyIHNlc3Npb246TG9hZGVyID0gQXNzZXRMaWJyYXJ5LmdldExvYWRlcigpO1xuXHRcdHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcihMb2FkZXJFdmVudC5MT0FEX0NPTVBMRVRFLCAoZXZlbnQ6TG9hZGVyRXZlbnQpID0+IHRoaXMub25Mb2FkQ29tcGxldGUoZXZlbnQpKTtcblx0XHRzZXNzaW9uLmxvYWQobmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy9kb3RzLnBuZycpKTtcblxuXHRcdHdpbmRvdy5vbnJlc2l6ZSA9IChldmVudDpVSUV2ZW50KSA9PiB0aGlzLm9uUmVzaXplKGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25Mb2FkQ29tcGxldGUoZXZlbnQ6TG9hZGVyRXZlbnQpXG5cdHtcblx0XHR2YXIgbG9hZGVyOkxvYWRlciA9IGV2ZW50LnRhcmdldDtcblx0XHR2YXIgbDpudW1iZXIgPSBsb2FkZXIuYmFzZURlcGVuZGVuY3kuYXNzZXRzLmxlbmd0aDtcblxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGw7IGMrKykge1xuXG5cdFx0XHR2YXIgYXNzZXQ6SUFzc2V0ID0gbG9hZGVyLmJhc2VEZXBlbmRlbmN5LmFzc2V0c1tjXTtcblxuXHRcdFx0c3dpdGNoIChhc3NldC5hc3NldFR5cGUpIHtcblx0XHRcdFx0Y2FzZSBCaXRtYXBJbWFnZTJELmFzc2V0VHlwZTpcblxuXHRcdFx0XHRcdHZhciBwcmVmYWI6UHJpbWl0aXZlUGxhbmVQcmVmYWIgPSBuZXcgUHJpbWl0aXZlUGxhbmVQcmVmYWIobnVsbCwgRWxlbWVudHNUeXBlLlRSSUFOR0xFLCA1MDAgLCA1MDAsIDEsIDEsIGZhbHNlKTtcblx0XHRcdFx0XHR2YXIgYml0bWFwOkJpdG1hcEltYWdlMkQgPSBuZXcgQml0bWFwSW1hZ2UyRCgxMDI0LCAxMDI0LCB0cnVlLCAweDAwMDAwMDAwKTtcblxuXHRcdFx0XHRcdHZhciBpbWFnZUNhbnZhczpIVE1MQ2FudmFzRWxlbWVudCA9IDxIVE1MQ2FudmFzRWxlbWVudD4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcblx0XHRcdFx0XHRpbWFnZUNhbnZhcy53aWR0aCA9IDEwMjQ7XG5cdFx0XHRcdFx0aW1hZ2VDYW52YXMuaGVpZ2h0ID0gMTAyNDtcblx0XHRcdFx0XHR2YXIgY29udGV4dDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSBpbWFnZUNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG5cdFx0XHRcdFx0dmFyIGltYWdlRGF0YTpJbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCAxMDI0LCAxMDI0KTtcblxuXHRcdFx0XHRcdGNvbnRleHQudHJhbnNsYXRlKDAsIDEwMjQpO1xuXHRcdFx0XHRcdGNvbnRleHQuc2NhbGUoMSwgLTEpO1xuXHRcdFx0XHRcdGNvbnRleHQuZHJhd0ltYWdlKCg8Qml0bWFwSW1hZ2UyRD4gYXNzZXQpLmdldENhbnZhcygpLCAwLCAwLCAxMDI0LCAxMDI0KTtcblxuXHRcdFx0XHRcdHZhciBncmFkaWVudCA9IGNvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgMTAyNCk7XG5cdFx0XHRcdFx0Z3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuOCwgXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDEuMClcIik7XG5cdFx0XHRcdFx0Z3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpXCIpO1xuXG5cdFx0XHRcdFx0Y29udGV4dC5maWxsU3R5bGUgPSBncmFkaWVudDtcblx0XHRcdFx0XHRjb250ZXh0LnJlY3QoMCwgMCwgMTAyNCwgMTAyNCk7XG5cdFx0XHRcdFx0Y29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImRlc3RpbmF0aW9uLW91dFwiO1xuXHRcdFx0XHRcdGNvbnRleHQuZmlsbCgpO1xuXG5cdFx0XHRcdFx0Yml0bWFwLmRyYXcoaW1hZ2VDYW52YXMpO1xuXG5cdFx0XHRcdFx0dmFyIGJpdG1hcENsb25lOkJpdG1hcEltYWdlMkQgPSBuZXcgQml0bWFwSW1hZ2UyRCgxMDI0LCAxMDI0LCB0cnVlLCAweDAwMDAwMDAwKTtcblx0XHRcdFx0XHRiaXRtYXBDbG9uZS5jb3B5UGl4ZWxzKGJpdG1hcCwgYml0bWFwQ2xvbmUucmVjdCwgYml0bWFwQ2xvbmUucmVjdCk7XG5cblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJpdG1hcC5nZXRDYW52YXMoKSk7XG5cblx0XHRcdFx0XHR2YXIgbWF0ZXJpYWw6QmFzaWNNYXRlcmlhbCA9IG5ldyBCYXNpY01hdGVyaWFsKGJpdG1hcENsb25lKTtcblx0XHRcdFx0XHRtYXRlcmlhbC5ib3RoU2lkZXMgPSB0cnVlO1xuXHRcdFx0XHRcdG1hdGVyaWFsLmFscGhhQmxlbmRpbmcgPSB0cnVlO1xuXG5cdFx0XHRcdFx0dmFyIG1hdGVyaWFsMjpCYXNpY01hdGVyaWFsID0gbmV3IEJhc2ljTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGFzc2V0KTtcblx0XHRcdFx0XHRtYXRlcmlhbDIuYm90aFNpZGVzID0gdHJ1ZTtcblx0XHRcdFx0XHRtYXRlcmlhbDIuYWxwaGFCbGVuZGluZyA9IHRydWU7XG5cblx0XHRcdFx0XHR0aGlzLnJlZmxlY3Rpb25TcHJpdGUgPSA8U3ByaXRlPiBwcmVmYWIuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRcdFx0dGhpcy5yZWZsZWN0aW9uU3ByaXRlLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMucmVmbGVjdGlvblNwcml0ZSk7XG5cblx0XHRcdFx0XHR0aGlzLmZ1bGxtZXNoID0gPFNwcml0ZT4gcHJlZmFiLmdldE5ld09iamVjdCgpO1xuXHRcdFx0XHRcdHRoaXMuZnVsbG1lc2gubWF0ZXJpYWwgPSBtYXRlcmlhbDI7XG5cdFx0XHRcdFx0dGhpcy5mdWxsbWVzaC5yb3RhdGlvblkgPSA5MDtcblx0XHRcdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5mdWxsbWVzaCk7XG5cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnJhZi5zdGFydCgpO1xuXHRcdHRoaXMub25SZXNpemUoKTtcblx0fVxuXG5cdHByaXZhdGUgb25SZXNpemUoZXZlbnQ6VUlFdmVudCA9IG51bGwpXG5cdHtcblx0XHR0aGlzLnZpZXcueCA9IHdpbmRvdy5pbm5lcldpZHRoLzI7XG5cdFx0dGhpcy52aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGgvMjtcblx0XHR0aGlzLnZpZXcuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXHR9XG5cblx0cHJpdmF0ZSByZW5kZXIoKVxuXHR7XG5cdFx0dGhpcy5mdWxsbWVzaC5yb3RhdGlvblkgKz0uNTtcblx0XHR0aGlzLnJlZmxlY3Rpb25TcHJpdGUucm90YXRpb25ZICs9LjU7XG5cblx0XHR0aGlzLnZpZXcucmVuZGVyKCk7XG5cdH1cbn0iXSwic291cmNlUm9vdCI6Ii4vdGVzdHMifQ==
