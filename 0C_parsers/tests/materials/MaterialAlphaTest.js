"use strict";
var BitmapImage2D_1 = require("awayjs-core/lib/image/BitmapImage2D");
var Sampler2D_1 = require("awayjs-core/lib/image/Sampler2D");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D_1 = require("awayjs-core/lib/geom/Vector3D");
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View_1 = require("awayjs-display/lib/View");
var DirectionalLight_1 = require("awayjs-display/lib/display/DirectionalLight");
var Sprite_1 = require("awayjs-display/lib/display/Sprite");
var ElementsType_1 = require("awayjs-display/lib/graphics/ElementsType");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var PrimitiveTorusPrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");
var PrimitiveCubePrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveCubePrefab");
var PrimitiveCapsulePrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var OBJParser_1 = require("awayjs-parsers/lib/OBJParser");
var MaterialAlphaTest = (function () {
    function MaterialAlphaTest() {
        var _this = this;
        this.sprites = new Array();
        this.aValues = Array(0, .1, .5, .8, .9, .99, 1);
        this.aValuesP = 0;
        Debug_1.Debug.LOG_PI_ERRORS = false;
        Debug_1.Debug.THROW_ERRORS = false;
        this.view = new View_1.View(new DefaultRenderer_1.DefaultRenderer());
        this.raf = new RequestAnimationFrame_1.RequestAnimationFrame(this.render, this);
        this.onResize();
        this.light = new DirectionalLight_1.DirectionalLight();
        this.light.color = 0xFFFFFF;
        this.light.direction = new Vector3D_1.Vector3D(1, 1, 0);
        this.light.ambient = 0;
        this.light.ambientColor = 0xFFFFFF;
        this.light.diffuse = 1;
        this.light.specular = 1;
        this.lightB = new DirectionalLight_1.DirectionalLight();
        this.lightB.color = 0xFF0000;
        this.lightB.direction = new Vector3D_1.Vector3D(-1, 0, 1);
        this.lightB.ambient = 0;
        this.lightB.ambientColor = 0xFFFFFF;
        this.lightB.diffuse = 1;
        this.lightB.specular = 1;
        this.view.scene.addChild(this.light);
        this.view.scene.addChild(this.lightB);
        this.view.backgroundColor = 0x222222;
        AssetLibrary_1.AssetLibrary.enableParser(OBJParser_1.OBJParser);
        var session;
        session = AssetLibrary_1.AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent_1.LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.URLRequest('assets/platonic.obj'));
        session = AssetLibrary_1.AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent_1.LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.URLRequest('assets/dots.png'));
        window.onresize = function (event) { return _this.onResize(event); };
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
    }
    MaterialAlphaTest.prototype.onMouseDown = function (event) {
        this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = this.aValues[this.aValuesP];
        alert('Alpha: ' + this.aValues[this.aValuesP]);
        this.aValuesP++;
        if (this.aValuesP > this.aValues.length - 1)
            this.aValuesP = 0;
    };
    MaterialAlphaTest.prototype.render = function (dt) {
        if (this.sprites)
            for (var c = 0; c < this.sprites.length; c++)
                this.sprites[c].rotationY += .35;
        this.view.render();
    };
    MaterialAlphaTest.prototype.onLoadComplete = function (event) {
        var loader = event.target;
        var l = loader.baseDependency.assets.length;
        for (var c = 0; c < l; c++) {
            var d = loader.baseDependency.assets[c];
            console.log(d.name);
            switch (d.assetType) {
                case Sprite_1.Sprite.assetType:
                    var sprite = d;
                    this.loadedSprite = sprite;
                    if (d.name == 'Sprite_g0') {
                        this.loadedSprite = sprite;
                        sprite.y = -400;
                        sprite.transform.scaleTo(5, 5, 5);
                    }
                    else {
                        sprite.transform.scaleTo(3.5, 3.5, 3.5);
                    }
                    if (this.loadedSpriteMaterial)
                        sprite.material = this.loadedSpriteMaterial;
                    this.view.scene.addChild(sprite);
                    this.sprites.push(sprite);
                    this.raf.start();
                    break;
                case BitmapImage2D_1.BitmapImage2D.assetType:
                    // Light Picker
                    this.staticLightPicker = new StaticLightPicker_1.StaticLightPicker([this.light, this.lightB]);
                    // Material for loaded sprite
                    this.loadedSpriteMaterial = new MethodMaterial_1.MethodMaterial(d);
                    this.loadedSpriteMaterial.style.sampler = new Sampler2D_1.Sampler2D(true, true, false);
                    this.loadedSpriteMaterial.lightPicker = this.staticLightPicker;
                    this.loadedSpriteMaterial.alpha = 1;
                    this.loadedSpriteMaterial.bothSides = true;
                    if (this.loadedSprite)
                        this.loadedSprite.material = this.loadedSpriteMaterial;
                    // Torus Texture Material
                    this.torusTextureMaterial = new MethodMaterial_1.MethodMaterial(d);
                    this.torusTextureMaterial.style.sampler = new Sampler2D_1.Sampler2D(true, true, false);
                    this.torusTextureMaterial.lightPicker = this.staticLightPicker;
                    this.torusTextureMaterial.bothSides = true;
                    this.torusTextureMaterial.alpha = .8;
                    // Torus
                    var torus = new PrimitiveTorusPrefab_1.PrimitiveTorusPrefab(this.torusTextureMaterial, ElementsType_1.ElementsType.TRIANGLE, 150, 50, 64, 64);
                    // Torus Sprite ( left )
                    var torusSprite = torus.getNewObject();
                    torusSprite.rotationX = 90;
                    torusSprite.x = 600;
                    this.sprites.push(torusSprite);
                    this.view.scene.addChild(torusSprite);
                    // Torus Color Material
                    this.cubeColorMaterial = new MethodMaterial_1.MethodMaterial(0x0090ff);
                    this.cubeColorMaterial.lightPicker = this.staticLightPicker;
                    this.cubeColorMaterial.alpha = .8;
                    this.cubeColorMaterial.bothSides = true;
                    var cube = new PrimitiveCubePrefab_1.PrimitiveCubePrefab(this.cubeColorMaterial, ElementsType_1.ElementsType.TRIANGLE, 300, 300, 300, 20, 20, 20);
                    // Torus Sprite ( right )
                    var cubeSprite = cube.getNewObject();
                    cubeSprite.rotationX = 90;
                    cubeSprite.x = -600;
                    this.sprites.push(cubeSprite);
                    this.view.scene.addChild(cubeSprite);
                    this.capsuleColorMaterial = new MethodMaterial_1.MethodMaterial(0x00ffff);
                    this.capsuleColorMaterial.lightPicker = this.staticLightPicker;
                    var capsule = new PrimitiveCapsulePrefab_1.PrimitiveCapsulePrefab(this.capsuleColorMaterial, ElementsType_1.ElementsType.TRIANGLE, 100, 200);
                    // Torus Sprite ( right )
                    var capsuleSprite = capsule.getNewObject();
                    this.sprites.push(capsuleSprite);
                    this.view.scene.addChild(capsuleSprite);
                    this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = 1;
                    break;
            }
        }
    };
    MaterialAlphaTest.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    return MaterialAlphaTest;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hdGVyaWFscy9NYXRlcmlhbEFscGhhVGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEJBQStCLHFDQUFxQyxDQUFDLENBQUE7QUFDckUsMEJBQTRCLGlDQUFpQyxDQUFDLENBQUE7QUFDOUQsNEJBQThCLG9DQUFvQyxDQUFDLENBQUE7QUFDbkUseUJBQTRCLCtCQUErQixDQUFDLENBQUE7QUFDNUQsNkJBQStCLHNDQUFzQyxDQUFDLENBQUE7QUFHdEUsMkJBQTZCLGdDQUFnQyxDQUFDLENBQUE7QUFDOUQsc0JBQXlCLDZCQUE2QixDQUFDLENBQUE7QUFDdkQsc0NBQXFDLDZDQUE2QyxDQUFDLENBQUE7QUFFbkYscUJBQXlCLHlCQUF5QixDQUFDLENBQUE7QUFDbkQsaUNBQWtDLDZDQUE2QyxDQUFDLENBQUE7QUFDaEYsdUJBQTBCLG1DQUFtQyxDQUFDLENBQUE7QUFDOUQsNkJBQStCLDBDQUEwQyxDQUFDLENBQUE7QUFDMUUsa0NBQWtDLDZEQUE2RCxDQUFDLENBQUE7QUFDaEcscUNBQXFDLGlEQUFpRCxDQUFDLENBQUE7QUFDdkYsb0NBQW9DLGdEQUFnRCxDQUFDLENBQUE7QUFDckYsdUNBQXNDLG1EQUFtRCxDQUFDLENBQUE7QUFFMUYsZ0NBQWlDLHVDQUF1QyxDQUFDLENBQUE7QUFFekUsK0JBQWdDLDJDQUEyQyxDQUFDLENBQUE7QUFFNUUsMEJBQTRCLDhCQUE4QixDQUFDLENBQUE7QUFFM0Q7SUFrQkM7UUFsQkQsaUJBNkxDO1FBekxRLFlBQU8sR0FBb0IsSUFBSSxLQUFLLEVBQVUsQ0FBQztRQU0vQyxZQUFPLEdBQWlCLEtBQUssQ0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRSxhQUFRLEdBQVUsQ0FBQyxDQUFDO1FBUzNCLGFBQUssQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzVCLGFBQUssQ0FBQyxZQUFZLEdB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QUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3ZDLENBQUM7SUFDRix3QkFBQztBQUFELENBN0xBLEFBNkxDLElBQUEiLCJmaWxlIjoibWF0ZXJpYWxzL01hdGVyaWFsQWxwaGFUZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtCaXRtYXBJbWFnZTJEfVx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9CaXRtYXBJbWFnZTJEXCI7XG5pbXBvcnQge1NhbXBsZXIyRH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9TYW1wbGVyMkRcIjtcbmltcG9ydCB7TG9hZGVyRXZlbnR9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCI7XG5pbXBvcnQge1ZlY3RvcjNEfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiO1xuaW1wb3J0IHtBc3NldExpYnJhcnl9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldExpYnJhcnlcIjtcbmltcG9ydCB7TG9hZGVyfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Mb2FkZXJcIjtcbmltcG9ydCB7SUFzc2V0fVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIjtcbmltcG9ydCB7VVJMUmVxdWVzdH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IHtEZWJ1Z31cdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0RlYnVnXCI7XG5pbXBvcnQge1JlcXVlc3RBbmltYXRpb25GcmFtZX1cdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIjtcblxuaW1wb3J0IHtWaWV3fVx0XHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9WaWV3XCI7XG5pbXBvcnQge0RpcmVjdGlvbmFsTGlnaHR9XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvRGlyZWN0aW9uYWxMaWdodFwiO1xuaW1wb3J0IHtTcHJpdGV9XHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9kaXNwbGF5L1Nwcml0ZVwiO1xuaW1wb3J0IHtFbGVtZW50c1R5cGV9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZ3JhcGhpY3MvRWxlbWVudHNUeXBlXCI7XG5pbXBvcnQge1N0YXRpY0xpZ2h0UGlja2VyfVx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9TdGF0aWNMaWdodFBpY2tlclwiO1xuaW1wb3J0IHtQcmltaXRpdmVUb3J1c1ByZWZhYn1cdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlVG9ydXNQcmVmYWJcIjtcbmltcG9ydCB7UHJpbWl0aXZlQ3ViZVByZWZhYn1cdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlQ3ViZVByZWZhYlwiO1xuaW1wb3J0IHtQcmltaXRpdmVDYXBzdWxlUHJlZmFifVx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYlwiO1xuXG5pbXBvcnQge0RlZmF1bHRSZW5kZXJlcn1cdFx0XHRcdGZyb20gXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCI7XG5cbmltcG9ydCB7TWV0aG9kTWF0ZXJpYWx9XHRcdFx0XHRmcm9tIFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvTWV0aG9kTWF0ZXJpYWxcIjtcblxuaW1wb3J0IHtPQkpQYXJzZXJ9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtcGFyc2Vycy9saWIvT0JKUGFyc2VyXCI7XG5cbmNsYXNzIE1hdGVyaWFsQWxwaGFUZXN0XG57XG5cdHByaXZhdGUgdmlldzpWaWV3O1xuXHRwcml2YXRlIHJhZjpSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XG5cdHByaXZhdGUgc3ByaXRlcyAgOiBBcnJheTxTcHJpdGU+ID0gbmV3IEFycmF5PFNwcml0ZT4oKTtcblx0cHJpdmF0ZSBsb2FkZWRTcHJpdGVNYXRlcmlhbDpNZXRob2RNYXRlcmlhbDtcblx0cHJpdmF0ZSBsaWdodDpEaXJlY3Rpb25hbExpZ2h0O1xuXHRwcml2YXRlIGxpZ2h0QjpEaXJlY3Rpb25hbExpZ2h0O1xuXHRwcml2YXRlIGxvYWRlZFNwcml0ZTpTcHJpdGU7XG5cblx0cHJpdmF0ZSBhVmFsdWVzOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDAsIC4xLCAuNSwgLjgsIC45LCAuOTksIDEpO1xuXHRwcml2YXRlIGFWYWx1ZXNQOm51bWJlciA9IDA7XG5cblx0cHJpdmF0ZSB0b3J1c1RleHR1cmVNYXRlcmlhbDpNZXRob2RNYXRlcmlhbDtcblx0cHJpdmF0ZSBjdWJlQ29sb3JNYXRlcmlhbDpNZXRob2RNYXRlcmlhbDtcblx0cHJpdmF0ZSBjYXBzdWxlQ29sb3JNYXRlcmlhbDpNZXRob2RNYXRlcmlhbDtcblx0cHJpdmF0ZSBzdGF0aWNMaWdodFBpY2tlcjpTdGF0aWNMaWdodFBpY2tlcjtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHREZWJ1Zy5MT0dfUElfRVJST1JTID0gZmFsc2U7XG5cdFx0RGVidWcuVEhST1dfRVJST1JTID0gZmFsc2U7XG5cblx0XHR0aGlzLnZpZXcgPSBuZXcgVmlldyhuZXcgRGVmYXVsdFJlbmRlcmVyKCkpO1xuXHRcdHRoaXMucmFmID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlciwgdGhpcyk7XG5cdFx0dGhpcy5vblJlc2l6ZSgpO1xuXG5cdFx0dGhpcy5saWdodCA9IG5ldyBEaXJlY3Rpb25hbExpZ2h0KCk7XG5cdFx0dGhpcy5saWdodC5jb2xvciA9IDB4RkZGRkZGO1xuXHRcdHRoaXMubGlnaHQuZGlyZWN0aW9uID0gbmV3IFZlY3RvcjNEKDEsIDEsIDApO1xuXHRcdHRoaXMubGlnaHQuYW1iaWVudCA9IDA7XG5cdFx0dGhpcy5saWdodC5hbWJpZW50Q29sb3IgPSAweEZGRkZGRjtcblx0XHR0aGlzLmxpZ2h0LmRpZmZ1c2UgPSAxO1xuXHRcdHRoaXMubGlnaHQuc3BlY3VsYXIgPSAxO1xuXG5cdFx0dGhpcy5saWdodEIgPSBuZXcgRGlyZWN0aW9uYWxMaWdodCgpO1xuXHRcdHRoaXMubGlnaHRCLmNvbG9yPSAweEZGMDAwMDtcblx0XHR0aGlzLmxpZ2h0Qi5kaXJlY3Rpb24gPSBuZXcgVmVjdG9yM0QoLTEsIDAsIDEpO1xuXHRcdHRoaXMubGlnaHRCLmFtYmllbnQgPSAwO1xuXHRcdHRoaXMubGlnaHRCLmFtYmllbnRDb2xvciA9IDB4RkZGRkZGO1xuXHRcdHRoaXMubGlnaHRCLmRpZmZ1c2UgPSAxO1xuXHRcdHRoaXMubGlnaHRCLnNwZWN1bGFyID0gMTtcblxuXHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLmxpZ2h0KTtcblx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5saWdodEIpO1xuXG5cdFx0dGhpcy52aWV3LmJhY2tncm91bmRDb2xvciA9IDB4MjIyMjIyO1xuXG5cdFx0QXNzZXRMaWJyYXJ5LmVuYWJsZVBhcnNlcihPQkpQYXJzZXIpO1xuXG5cdFx0dmFyIHNlc3Npb246TG9hZGVyO1xuXG5cdFx0c2Vzc2lvbiA9IEFzc2V0TGlicmFyeS5nZXRMb2FkZXIoKTtcblx0XHRzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuTE9BRF9DT01QTEVURSwgKGV2ZW50OkxvYWRlckV2ZW50KSA9PiB0aGlzLm9uTG9hZENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0c2Vzc2lvbi5sb2FkKG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvcGxhdG9uaWMub2JqJykpO1xuXG5cdFx0c2Vzc2lvbiA9IEFzc2V0TGlicmFyeS5nZXRMb2FkZXIoKTtcblx0XHRzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuTE9BRF9DT01QTEVURSwgKGV2ZW50OkxvYWRlckV2ZW50KSA9PiB0aGlzLm9uTG9hZENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0c2Vzc2lvbi5sb2FkKG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvZG90cy5wbmcnKSk7XG5cblx0XHR3aW5kb3cub25yZXNpemUgPSAoZXZlbnQ6VUlFdmVudCkgPT4gdGhpcy5vblJlc2l6ZShldmVudCk7XG5cdFx0ZG9jdW1lbnQub25tb3VzZWRvd24gPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlRG93bihldmVudCk7XG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VEb3duKGV2ZW50Ok1vdXNlRXZlbnQpXG5cdHtcblx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsLmFscGhhID0gdGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbC5hbHBoYSA9IHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYWxwaGEgPSB0aGlzLmFWYWx1ZXNbdGhpcy5hVmFsdWVzUF07XG5cblx0XHRhbGVydCggJ0FscGhhOiAnICsgdGhpcy5hVmFsdWVzW3RoaXMuYVZhbHVlc1BdKTtcblxuXHRcdHRoaXMuYVZhbHVlc1ArKztcblxuXHRcdGlmICh0aGlzLmFWYWx1ZXNQID4gdGhpcy5hVmFsdWVzLmxlbmd0aCAtMSlcblx0XHRcdHRoaXMuYVZhbHVlc1AgID0gMDtcblx0fVxuXG5cdHByaXZhdGUgcmVuZGVyKGR0Om51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLnNwcml0ZXMpXG5cdFx0XHRmb3IgKHZhciBjOm51bWJlciA9IDA7IGMgPCB0aGlzLnNwcml0ZXMubGVuZ3RoOyBjKyspXG5cdFx0XHRcdHRoaXMuc3ByaXRlc1tjXS5yb3RhdGlvblkgKz0gLjM1O1xuXG5cdFx0dGhpcy52aWV3LnJlbmRlcigpO1xuXHR9XG5cblx0cHVibGljIG9uTG9hZENvbXBsZXRlKGV2ZW50OkxvYWRlckV2ZW50KVxuXHR7XG5cdFx0dmFyIGxvYWRlcjpMb2FkZXIgPSBldmVudC50YXJnZXQ7XG5cdFx0dmFyIGw6bnVtYmVyID0gbG9hZGVyLmJhc2VEZXBlbmRlbmN5LmFzc2V0cy5sZW5ndGhcblxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGw7IGMgKyspIHtcblxuXHRcdFx0dmFyIGQ6SUFzc2V0ID0gbG9hZGVyLmJhc2VEZXBlbmRlbmN5LmFzc2V0c1tjXTtcblxuXHRcdFx0Y29uc29sZS5sb2coIGQubmFtZSk7XG5cblx0XHRcdHN3aXRjaCAoZC5hc3NldFR5cGUpIHtcblx0XHRcdFx0Y2FzZSBTcHJpdGUuYXNzZXRUeXBlOlxuXHRcdFx0XHRcdHZhciBzcHJpdGU6U3ByaXRlID0gPFNwcml0ZT4gZDtcblxuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlID0gc3ByaXRlO1xuXG5cdFx0XHRcdFx0aWYgKGQubmFtZSA9PSAnU3ByaXRlX2cwJykge1xuXHRcdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGUgPSBzcHJpdGU7XG5cdFx0XHRcdFx0XHRzcHJpdGUueSA9IC00MDA7XG5cdFx0XHRcdFx0XHRzcHJpdGUudHJhbnNmb3JtLnNjYWxlVG8oNSwgNSwgNSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHNwcml0ZS50cmFuc2Zvcm0uc2NhbGVUbygzLjUsIDMuNSwgMy41KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbClcblx0XHRcdFx0XHRcdHNwcml0ZS5tYXRlcmlhbCA9IHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWw7XG5cblx0XHRcdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQoc3ByaXRlKTtcblx0XHRcdFx0XHR0aGlzLnNwcml0ZXMucHVzaChzcHJpdGUpO1xuXG5cdFx0XHRcdFx0dGhpcy5yYWYuc3RhcnQoKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBCaXRtYXBJbWFnZTJELmFzc2V0VHlwZTpcblx0XHRcdFx0XHQvLyBMaWdodCBQaWNrZXJcblx0XHRcdFx0XHR0aGlzLnN0YXRpY0xpZ2h0UGlja2VyID0gbmV3IFN0YXRpY0xpZ2h0UGlja2VyKCBbdGhpcy5saWdodCAsIHRoaXMubGlnaHRCIF0gKTtcblxuXHRcdFx0XHRcdC8vIE1hdGVyaWFsIGZvciBsb2FkZWQgc3ByaXRlXG5cdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbCA9IG5ldyBNZXRob2RNYXRlcmlhbCg8Qml0bWFwSW1hZ2UyRD4gZCk7XG5cdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbC5zdHlsZS5zYW1wbGVyID0gbmV3IFNhbXBsZXIyRCh0cnVlLCB0cnVlLCBmYWxzZSk7XG5cdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbC5saWdodFBpY2tlciA9IHRoaXMuc3RhdGljTGlnaHRQaWNrZXI7XG5cdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbC5hbHBoYSA9IDE7XG5cdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbC5ib3RoU2lkZXMgPSB0cnVlO1xuXG5cdFx0XHRcdFx0aWYgKHRoaXMubG9hZGVkU3ByaXRlKVxuXHRcdFx0XHRcdFx0dGhpcy5sb2FkZWRTcHJpdGUubWF0ZXJpYWwgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgVGV4dHVyZSBNYXRlcmlhbFxuXHRcdFx0XHRcdHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGQpO1xuXHRcdFx0XHRcdHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuc3R5bGUuc2FtcGxlciA9IG5ldyBTYW1wbGVyMkQodHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xuXHRcdFx0XHRcdHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyIDtcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsLmJvdGhTaWRlcyA9IHRydWU7XG5cdFx0XHRcdFx0dGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbC5hbHBoYSA9IC44O1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXNcblx0XHRcdFx0XHR2YXIgdG9ydXM6UHJpbWl0aXZlVG9ydXNQcmVmYWIgPSBuZXcgUHJpbWl0aXZlVG9ydXNQcmVmYWIodGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbCwgRWxlbWVudHNUeXBlLlRSSUFOR0xFLCAxNTAgLCA1MCAsIDY0ICwgNjQpO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgU3ByaXRlICggbGVmdCApXG5cdFx0XHRcdFx0dmFyIHRvcnVzU3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IHRvcnVzLmdldE5ld09iamVjdCgpO1xuXHRcdFx0XHRcdHRvcnVzU3ByaXRlLnJvdGF0aW9uWCA9IDkwO1xuXHRcdFx0XHRcdHRvcnVzU3ByaXRlLnggPSA2MDA7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2godG9ydXNTcHJpdGUpO1xuXHRcdFx0XHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0b3J1c1Nwcml0ZSk7XG5cblx0XHRcdFx0XHQvLyBUb3J1cyBDb2xvciBNYXRlcmlhbFxuXHRcdFx0XHRcdHRoaXMuY3ViZUNvbG9yTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoMHgwMDkwZmYpO1xuXHRcdFx0XHRcdHRoaXMuY3ViZUNvbG9yTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyIDtcblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsLmFscGhhID0gLjg7XG5cdFx0XHRcdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5ib3RoU2lkZXMgPSB0cnVlO1xuXG5cdFx0XHRcdFx0dmFyIGN1YmU6UHJpbWl0aXZlQ3ViZVByZWZhYiA9IG5ldyBQcmltaXRpdmVDdWJlUHJlZmFiKHRoaXMuY3ViZUNvbG9yTWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMzAwLCAzMDAsIDMwMCwgMjAsIDIwLCAyMCk7XG5cblx0XHRcdFx0XHQvLyBUb3J1cyBTcHJpdGUgKCByaWdodCApXG5cdFx0XHRcdFx0dmFyIGN1YmVTcHJpdGU6U3ByaXRlID0gPFNwcml0ZT4gY3ViZS5nZXROZXdPYmplY3QoKTtcblx0XHRcdFx0XHRjdWJlU3ByaXRlLnJvdGF0aW9uWCA9IDkwO1xuXHRcdFx0XHRcdGN1YmVTcHJpdGUueCA9IC02MDA7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2goY3ViZVNwcml0ZSk7XG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKGN1YmVTcHJpdGUpO1xuXG5cdFx0XHRcdFx0dGhpcy5jYXBzdWxlQ29sb3JNYXRlcmlhbCA9IG5ldyBNZXRob2RNYXRlcmlhbCgweDAwZmZmZik7XG5cdFx0XHRcdFx0dGhpcy5jYXBzdWxlQ29sb3JNYXRlcmlhbC5saWdodFBpY2tlciA9IHRoaXMuc3RhdGljTGlnaHRQaWNrZXI7XG5cblx0XHRcdFx0XHR2YXIgY2Fwc3VsZTpQcmltaXRpdmVDYXBzdWxlUHJlZmFiID0gbmV3IFByaW1pdGl2ZUNhcHN1bGVQcmVmYWIodGhpcy5jYXBzdWxlQ29sb3JNYXRlcmlhbCwgRWxlbWVudHNUeXBlLlRSSUFOR0xFLCAxMDAsIDIwMCk7XG5cblx0XHRcdFx0XHQvLyBUb3J1cyBTcHJpdGUgKCByaWdodCApXG5cdFx0XHRcdFx0dmFyIGNhcHN1bGVTcHJpdGU6U3ByaXRlID0gPFNwcml0ZT4gY2Fwc3VsZS5nZXROZXdPYmplY3QoKTtcblx0XHRcdFx0XHR0aGlzLnNwcml0ZXMucHVzaChjYXBzdWxlU3ByaXRlKTtcblx0XHRcdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQoY2Fwc3VsZVNwcml0ZSk7XG5cblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsLmFscGhhID0gdGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbC5hbHBoYSA9IHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYWxwaGEgPSAxO1xuXG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIG9uUmVzaXplKGV2ZW50OlVJRXZlbnQgPSBudWxsKVxuXHR7XG5cdFx0dGhpcy52aWV3LnkgPSAwO1xuXHRcdHRoaXMudmlldy54ID0gMDtcblxuXHRcdHRoaXMudmlldy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHRcdHRoaXMudmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdH1cbn0iXSwic291cmNlUm9vdCI6Ii4vdGVzdHMifQ==
