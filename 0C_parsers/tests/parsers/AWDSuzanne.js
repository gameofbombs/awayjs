"use strict";
var AssetEvent_1 = require("awayjs-core/lib/events/AssetEvent");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D_1 = require("awayjs-core/lib/geom/Vector3D");
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var Graphics_1 = require("awayjs-display/lib/graphics/Graphics");
var View_1 = require("awayjs-display/lib/View");
var DirectionalLight_1 = require("awayjs-display/lib/display/DirectionalLight");
var Sprite_1 = require("awayjs-display/lib/display/Sprite");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var AWDParser_1 = require("awayjs-parsers/lib/AWDParser");
var AWDSuzanne = (function () {
    function AWDSuzanne() {
        var _this = this;
        this.lookAtPosition = new Vector3D_1.Vector3D();
        this._cameraIncrement = 0;
        Debug_1.Debug.LOG_PI_ERRORS = true;
        Debug_1.Debug.THROW_ERRORS = false;
        AssetLibrary_1.AssetLibrary.enableParser(AWDParser_1.AWDParser);
        var session = AssetLibrary_1.AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent_1.LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.addEventListener(AssetEvent_1.AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        session.load(new URLRequest_1.URLRequest('assets/suzanne.awd'));
        this._view = new View_1.View(new DefaultRenderer_1.DefaultRenderer());
        this._view.camera.projection.far = 6000;
        this._timer = new RequestAnimationFrame_1.RequestAnimationFrame(this.render, this);
        this._light = new DirectionalLight_1.DirectionalLight();
        this._light.color = 0x683019; //683019;
        this._light.direction = new Vector3D_1.Vector3D(1, 0, 0);
        this._light.ambient = 0.1; //0.05;//.4;
        this._light.ambientColor = 0x85b2cd; //4F6877;//313D51;
        this._light.diffuse = 2.8;
        this._light.specular = 1.8;
        this._view.scene.addChild(this._light);
        this._lightPicker = new StaticLightPicker_1.StaticLightPicker([this._light]);
        window.onresize = function (event) { return _this.resize(event); };
        this._timer.start();
        this.resize();
    }
    AWDSuzanne.prototype.resize = function (event) {
        if (event === void 0) { event = null; }
        this._view.y = 0;
        this._view.x = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };
    AWDSuzanne.prototype.render = function (dt) {
        if (this._view.camera) {
            this._view.camera.lookAt(this.lookAtPosition);
            this._cameraIncrement += 0.01;
            this._view.camera.x = Math.cos(this._cameraIncrement) * 1400;
            this._view.camera.z = Math.sin(this._cameraIncrement) * 1400;
            this._light.x = Math.cos(this._cameraIncrement) * 1400;
            this._light.y = Math.sin(this._cameraIncrement) * 1400;
        }
        this._view.render();
    };
    AWDSuzanne.prototype.onAssetComplete = function (event) {
        console.log('------------------------------------------------------------------------------');
        console.log('away.events.AssetEvent.ASSET_COMPLETE', AssetLibrary_1.AssetLibrary.getAsset(event.asset.name));
        console.log('------------------------------------------------------------------------------');
    };
    AWDSuzanne.prototype.onLoadComplete = function (event) {
        console.log('------------------------------------------------------------------------------');
        console.log('away.events.LoaderEvent.RESOURCE_COMPLETE', event);
        console.log('------------------------------------------------------------------------------');
        var loader = event.target;
        var numAssets = loader.baseDependency.assets.length;
        for (var i = 0; i < numAssets; ++i) {
            var asset = loader.baseDependency.assets[i];
            switch (asset.assetType) {
                case Sprite_1.Sprite.assetType:
                    this._suzanne = asset;
                    this._suzanne.material.lightPicker = this._lightPicker;
                    this._suzanne.y = -100;
                    for (var c = 0; c < 80; c++) {
                        var scale = this.getRandom(50, 200);
                        var clone = this._suzanne.clone();
                        clone.x = this.getRandom(-2000, 2000);
                        clone.y = this.getRandom(-2000, 2000);
                        clone.z = this.getRandom(-2000, 2000);
                        clone.transform.scaleTo(scale, scale, scale);
                        clone.rotationY = this.getRandom(0, 360);
                        this._view.scene.addChild(clone);
                    }
                    this._suzanne.transform.scaleTo(500, 500, 500);
                    this._view.scene.addChild(this._suzanne);
                    break;
                case Graphics_1.Graphics.assetType:
                    break;
                case MethodMaterial_1.MethodMaterial.assetType:
                    break;
            }
        }
    };
    AWDSuzanne.prototype.getRandom = function (min, max) {
        return Math.random() * (max - min) + min;
    };
    return AWDSuzanne;
}());

//# sourceMappingURL=data:application/json;base64,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UyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO29CQUUvQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUV6QyxLQUFLLENBQUM7Z0JBRVAsS0FBSyxtQkFBUSxDQUFDLFNBQVM7b0JBQ3RCLEtBQUssQ0FBQztnQkFFUCxLQUFLLCtCQUFjLENBQUMsU0FBUztvQkFFNUIsS0FBSyxDQUFDO1lBQ1IsQ0FBQztRQUNGLENBQUM7SUFDRixDQUFDO0lBRU8sOEJBQVMsR0FBakIsVUFBa0IsR0FBVSxFQUFFLEdBQVU7UUFFdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7SUFDeEMsQ0FBQztJQUNGLGlCQUFDO0FBQUQsQ0EvSEEsQUErSEMsSUFBQSIsImZpbGUiOiJwYXJzZXJzL0FXRFN1emFubmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0Fzc2V0RXZlbnR9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0Fzc2V0RXZlbnRcIjtcbmltcG9ydCB7TG9hZGVyRXZlbnR9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCI7XG5pbXBvcnQge1ZlY3RvcjNEfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiO1xuaW1wb3J0IHtBc3NldExpYnJhcnl9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldExpYnJhcnlcIjtcbmltcG9ydCB7TG9hZGVyfVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Mb2FkZXJcIjtcbmltcG9ydCB7SUFzc2V0fVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIjtcbmltcG9ydCB7VVJMUmVxdWVzdH1cdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IHtEZWJ1Z31cdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0RlYnVnXCI7XG5pbXBvcnQge1JlcXVlc3RBbmltYXRpb25GcmFtZX1cdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIjtcblxuaW1wb3J0IHtHcmFwaGljc31cdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2dyYXBoaWNzL0dyYXBoaWNzXCI7XG5pbXBvcnQge1ZpZXd9XHRcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL1ZpZXdcIjtcbmltcG9ydCB7RGlyZWN0aW9uYWxMaWdodH1cdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9EaXJlY3Rpb25hbExpZ2h0XCI7XG5pbXBvcnQge1Nwcml0ZX1cdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvU3ByaXRlXCI7XG5pbXBvcnQge1N0YXRpY0xpZ2h0UGlja2VyfVx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9TdGF0aWNMaWdodFBpY2tlclwiO1xuXG5pbXBvcnQge0RlZmF1bHRSZW5kZXJlcn1cdFx0XHRcdGZyb20gXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCI7XG5cbmltcG9ydCB7TWV0aG9kTWF0ZXJpYWx9XHRcdFx0XHRmcm9tIFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvTWV0aG9kTWF0ZXJpYWxcIjtcblxuaW1wb3J0IHtBV0RQYXJzZXJ9XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtcGFyc2Vycy9saWIvQVdEUGFyc2VyXCI7XG5cbmNsYXNzIEFXRFN1emFubmVcbntcblx0cHJpdmF0ZSBfdmlldzpWaWV3O1xuXHRwcml2YXRlIF90aW1lcjpSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XG5cdHByaXZhdGUgX3N1emFubmU6U3ByaXRlO1xuXHRwcml2YXRlIF9saWdodDpEaXJlY3Rpb25hbExpZ2h0O1xuXHRwcml2YXRlIF9saWdodFBpY2tlcjpTdGF0aWNMaWdodFBpY2tlcjtcblx0cHJpdmF0ZSBsb29rQXRQb3NpdGlvbjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgpO1xuXHRwcml2YXRlIF9jYW1lcmFJbmNyZW1lbnQ6bnVtYmVyID0gMDtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHREZWJ1Zy5MT0dfUElfRVJST1JTID0gdHJ1ZTtcblx0XHREZWJ1Zy5USFJPV19FUlJPUlMgPSBmYWxzZTtcblxuXHRcdEFzc2V0TGlicmFyeS5lbmFibGVQYXJzZXIoQVdEUGFyc2VyKSA7XG5cblx0XHR2YXIgc2Vzc2lvbjpMb2FkZXIgPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcihBc3NldEV2ZW50LkFTU0VUX0NPTVBMRVRFLCAoZXZlbnQ6QXNzZXRFdmVudCkgPT4gdGhpcy5vbkFzc2V0Q29tcGxldGUoZXZlbnQpKTtcblx0XHRzZXNzaW9uLmxvYWQobmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy9zdXphbm5lLmF3ZCcpKTtcblxuXHRcdHRoaXMuX3ZpZXcgPSBuZXcgVmlldyhuZXcgRGVmYXVsdFJlbmRlcmVyKCkpO1xuXHRcdHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb24uZmFyICA9IDYwMDA7XG5cdFx0dGhpcy5fdGltZXIgPSBuZXcgUmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucmVuZGVyLCB0aGlzKTtcblxuXHRcdHRoaXMuX2xpZ2h0ID0gbmV3IERpcmVjdGlvbmFsTGlnaHQoKTtcblx0XHR0aGlzLl9saWdodC5jb2xvciA9IDB4NjgzMDE5Oy8vNjgzMDE5O1xuXHRcdHRoaXMuX2xpZ2h0LmRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzRCggMSAsIDAgLDAgKTtcblx0XHR0aGlzLl9saWdodC5hbWJpZW50ID0gMC4xOy8vMC4wNTsvLy40O1xuXHRcdHRoaXMuX2xpZ2h0LmFtYmllbnRDb2xvciA9IDB4ODViMmNkOy8vNEY2ODc3Oy8vMzEzRDUxO1xuXHRcdHRoaXMuX2xpZ2h0LmRpZmZ1c2UgPSAyLjg7XG5cdFx0dGhpcy5fbGlnaHQuc3BlY3VsYXIgPSAxLjg7XG5cdFx0dGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLl9saWdodCk7XG5cblx0XHR0aGlzLl9saWdodFBpY2tlciA9IG5ldyBTdGF0aWNMaWdodFBpY2tlcihbdGhpcy5fbGlnaHRdKTtcblxuXHRcdHdpbmRvdy5vbnJlc2l6ZSA9IChldmVudDpVSUV2ZW50KSA9PiB0aGlzLnJlc2l6ZShldmVudCk7XG5cblx0XHR0aGlzLl90aW1lci5zdGFydCgpO1xuXHRcdHRoaXMucmVzaXplKCk7XG5cdH1cblxuXHRwcml2YXRlIHJlc2l6ZShldmVudDpVSUV2ZW50ID0gbnVsbClcblx0e1xuXHRcdHRoaXMuX3ZpZXcueSA9IDA7XG5cdFx0dGhpcy5fdmlldy54ID0gMDtcblx0XHR0aGlzLl92aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0dGhpcy5fdmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdH1cblxuXHRwcml2YXRlIHJlbmRlcihkdDpudW1iZXIpIC8vYW5pbWF0ZSBiYXNlZCBvbiBkdCBmb3IgZmlyZWZveFxuXHR7XG5cdFx0aWYgKHRoaXMuX3ZpZXcuY2FtZXJhKSB7XG5cdFx0XHR0aGlzLl92aWV3LmNhbWVyYS5sb29rQXQodGhpcy5sb29rQXRQb3NpdGlvbikgO1xuXHRcdFx0dGhpcy5fY2FtZXJhSW5jcmVtZW50ICs9IDAuMDE7XG5cdFx0XHR0aGlzLl92aWV3LmNhbWVyYS54ID0gTWF0aC5jb3ModGhpcy5fY2FtZXJhSW5jcmVtZW50KSoxNDAwO1xuXHRcdFx0dGhpcy5fdmlldy5jYW1lcmEueiA9IE1hdGguc2luKHRoaXMuX2NhbWVyYUluY3JlbWVudCkqMTQwMDtcblxuXHRcdFx0dGhpcy5fbGlnaHQueCA9IE1hdGguY29zKHRoaXMuX2NhbWVyYUluY3JlbWVudCkqMTQwMDtcblx0XHRcdHRoaXMuX2xpZ2h0LnkgPSBNYXRoLnNpbih0aGlzLl9jYW1lcmFJbmNyZW1lbnQpKjE0MDA7XG5cdFx0fVxuXG5cdFx0dGhpcy5fdmlldy5yZW5kZXIoKTtcblx0fVxuXG5cdHB1YmxpYyBvbkFzc2V0Q29tcGxldGUoZXZlbnQ6QXNzZXRFdmVudClcblx0e1xuXHRcdGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0XHRjb25zb2xlLmxvZygnYXdheS5ldmVudHMuQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURScsIEFzc2V0TGlicmFyeS5nZXRBc3NldChldmVudC5hc3NldC5uYW1lKSk7XG5cdFx0Y29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHR9XG5cblx0cHVibGljIG9uTG9hZENvbXBsZXRlKGV2ZW50OkxvYWRlckV2ZW50KVxuXHR7XG5cdFx0Y29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXHRcdGNvbnNvbGUubG9nKCdhd2F5LmV2ZW50cy5Mb2FkZXJFdmVudC5SRVNPVVJDRV9DT01QTEVURScgLCBldmVudCk7XG5cdFx0Y29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXG5cdFx0dmFyIGxvYWRlcjpMb2FkZXIgPSBldmVudC50YXJnZXQ7XG5cdFx0dmFyIG51bUFzc2V0czpudW1iZXIgPSBsb2FkZXIuYmFzZURlcGVuZGVuY3kuYXNzZXRzLmxlbmd0aDtcblxuXHRcdGZvcih2YXIgaTpudW1iZXIgPSAwOyBpIDwgbnVtQXNzZXRzOyArK2kpIHtcblx0XHRcdHZhciBhc3NldDpJQXNzZXQgPSBsb2FkZXIuYmFzZURlcGVuZGVuY3kuYXNzZXRzW2ldO1xuXG5cdFx0XHRzd2l0Y2ggKGFzc2V0LmFzc2V0VHlwZSkge1xuXHRcdFx0XHRjYXNlIFNwcml0ZS5hc3NldFR5cGU6XG5cblx0XHRcdFx0XHR0aGlzLl9zdXphbm5lID0gPFNwcml0ZT4gYXNzZXQ7XG5cblx0XHRcdFx0XHQoPE1ldGhvZE1hdGVyaWFsPiB0aGlzLl9zdXphbm5lLm1hdGVyaWFsKS5saWdodFBpY2tlciA9IHRoaXMuX2xpZ2h0UGlja2VyO1xuXHRcdFx0XHRcdHRoaXMuX3N1emFubmUueSA9IC0xMDA7XG5cblxuXHRcdFx0XHRcdGZvciAoIHZhciBjIDogbnVtYmVyID0gMCA7IGMgPCA4MCA7IGMgKysgKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHZhciBzY2FsZTpudW1iZXIgPSB0aGlzLmdldFJhbmRvbSggNTAgLCAyMDAgKTtcblx0XHRcdFx0XHRcdHZhciBjbG9uZTpTcHJpdGUgPSA8U3ByaXRlPiB0aGlzLl9zdXphbm5lLmNsb25lKCk7XG5cdFx0XHRcdFx0XHRcdGNsb25lLnggPSB0aGlzLmdldFJhbmRvbSgtMjAwMCAsIDIwMDApO1xuXHRcdFx0XHRcdFx0XHRjbG9uZS55ID0gdGhpcy5nZXRSYW5kb20oLTIwMDAgLCAyMDAwKTtcblx0XHRcdFx0XHRcdFx0Y2xvbmUueiA9IHRoaXMuZ2V0UmFuZG9tKC0yMDAwICwgMjAwMCk7XG5cdFx0XHRcdFx0XHRcdGNsb25lLnRyYW5zZm9ybS5zY2FsZVRvKHNjYWxlLCBzY2FsZSwgc2NhbGUpO1xuXHRcdFx0XHRcdFx0XHRjbG9uZS5yb3RhdGlvblkgPSB0aGlzLmdldFJhbmRvbSgwICwgMzYwKTtcblx0XHRcdFx0XHRcdHRoaXMuX3ZpZXcuc2NlbmUuYWRkQ2hpbGQoIGNsb25lICk7XG5cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0aGlzLl9zdXphbm5lLnRyYW5zZm9ybS5zY2FsZVRvKDUwMCwgNTAwLCA1MDApO1xuXG5cdFx0XHRcdFx0dGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLl9zdXphbm5lKTtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgR3JhcGhpY3MuYXNzZXRUeXBlOlxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgTWV0aG9kTWF0ZXJpYWwuYXNzZXRUeXBlOlxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBnZXRSYW5kb20obWluOm51bWJlciwgbWF4Om51bWJlcik6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gTWF0aC5yYW5kb20oKSoobWF4IC0gbWluKSArIG1pbjtcblx0fVxufSJdLCJzb3VyY2VSb290IjoiLi90ZXN0cyJ9
